<head>

<%
let ogImage = '';
function isAbsoluteUrl(url) {
  return /^https?:\/\//i.test(url);
}
// 明示的に404.jpgを除外する処理を追加
function isValid404Image(url) {
  return !url.includes('404.jpg');
}
if (page.og_image && isValid404Image(page.og_image)) {
  // 記事固有の画像が設定されている場合
  if (isAbsoluteUrl(page.og_image)) {
    ogImage = page.og_image;
  } else {
    ogImage = config.url + (page.og_image.startsWith('/') ? page.og_image : '/' + page.og_image);
  }
} else if (config.og_image && isValid404Image(config.og_image)) {
  // サイト全体のデフォルトOGP画像
  ogImage = config.url + (config.og_image.startsWith('/') ? config.og_image : '/' + config.og_image);
}
%>
<% if (ogImage) { %>
<meta property="og:image" content="<%= ogImage %>">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="<%= ogImage %>">
<% } %>

  <meta charset="utf-8">
  <%- partial('google-analytics') %>
  <%
  var title = page.title;

  if (is_archive()){
    title = __('archive_a');

    if (is_month()){
      title += ': ' + page.year + '/' + page.month;
    } else if (is_year()){
      title += ': ' + page.year;
    }
  } else if (is_category()){
    title = __('category') + ': ' + page.category;
  } else if (is_tag()){
    title = __('tag') + ': ' + page.tag;
  }
  %>
  <title><% if (title){ %><%= title %> | <% } %><%= config.title %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <%- open_graph({twitter_id: theme.twitter, fb_admins: theme.fb_admins, fb_app_id: theme.fb_app_id}) %>
  <% if (config.feed) { %>
    <%- feed_tag() %>
  <% } else if (theme.rss) { %>
    <%- feed_tag(theme.rss) %>
  <% } %>
  <% if (theme.favicon){ %>
    <%- favicon_tag(theme.favicon) %>
  <% } %>
  <% if (config.highlight.enable){ %>
    <%- css('https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css') %>
  <% } %>
  <%- css('css/style') %>
  <% if (theme.fancybox){ %>
    <%- css('fancybox/jquery.fancybox.min.css') %>
  <% } %>
  <% if (theme.links) {%>
    <%- css('https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css') %>
  <% } %>
</head>
